{"version":3,"file":"Deferred.js","names":["DeferredPromise","resolver","resolve","reject","that","Object","assign","Promise","DefferedTrigger","workload","_workload","then","data","reason","Defer","_reject","_resolve","_called","_p","bind","executor","_executor","undefined","console","log","promise","called","execute","callback"],"sources":["../../src/src/Deferred.js"],"sourcesContent":["\n\n/**\n * @desc\n * implements deferred pattern\n * extended promise with exposed resolve and reject handlers\n *\n * passed resolver function\n *\n * @param? {Function} resolver function taking two params: function resolve and function reject\n * \t\tthis parameter is provided as default\n */\nexport class DeferredPromise extends Promise {\n\tconstructor(resolver=function(resolve, reject) {}) {\n\t\tconst that = {};\n\t\tsuper(function(resolve, reject) {\n\t\t\tObject.assign(that, {resolve, reject})\n\t\t});\n\t\tObject.assign(this, that)\n\t\tresolver(this.resolve, this.reject)\n\t}\n}\n\n\n/**\n * @desc\n * extended Deferred\n *\n * example:\n * \t\tnew Deferred(() => http.get(url))\n *\n * if we need to pass promise but we do not want to do the actual work yet\n * like e.g. REST calls throttling.\n *\n * @param {Function} takes as argument factory returning promise\n */\nexport class DefferedTrigger extends DeferredPromise {\n\tconstructor(workload) {\n\t\tsuper();\n\t\tthis._workload = workload\n\t}\n\n\ttrigger() {\n\t\treturn this._workload()\n\t\t\t.then((data) => {\n\t\t\t\tthis.resolve(data)\n\t\t\t})\n\t\t\t.catch(reason => {\n\t\t\t\tthis.reject(reason)\n\t\t\t})\n\t}\n}\n\n\n/**\n * @desc\n * defer the execution of the workload\n *\n * @param {Function} factory function returning a Promise (which needs to be deffered)\n *\n * @returns {Objcect} with deferred promise and an executor which triggers the promise fullfillment\n **/\nexport function Defer(workload) {\n\tlet _reject, _resolve, _called;\n\tconst _p = new Promise(function (resolve, reject) {\n\t\t_resolve = resolve;\n\t\t_reject = reject;\n\t}.bind(Defer))\n\n\tconst executor = (function (workload) {\n\t\tlet _executor = undefined;\n\n\t\treturn function() {\n\t\t\t_called = true;\n\t\t\tif (_executor) {\n\t\t\t\treturn _executor;\n\t\t\t\tconsole.log('returning original')\n\t\t\t}\n\t\t\treturn _executor = workload()\n\t\t\t\t.then(data => {\n\t\t\t\t\t_resolve(data)\n\t\t\t\t})\n\t\t\t\t.catch(reason => {\n\t\t\t\t\t_reject(reason)\n\t\t\t\t})\n\t\t}\n\t})(workload)\n\n\treturn {\n\t\tget promise() { return _p },\n\n\t\tget called() {\n\t\t\treturn _called ? true : false;\n\t\t},\n\n\t\texecute(callback=function() {}) {\n\t\t\texecutor().finally(callback)\n\t\t}\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA,IAUaA,eAAe;EAAA;EAAA;EAC3B,2BAAmD;IAAA;IAAA,IAAvCC,QAAQ,uEAAC,UAASC,OAAO,EAAEC,MAAM,EAAE,CAAC,CAAC;IAAA;IAChD,IAAMC,IAAI,GAAG,CAAC,CAAC;IACf,0BAAM,UAASF,OAAO,EAAEC,MAAM,EAAE;MAC/BE,MAAM,CAACC,MAAM,CAACF,IAAI,EAAE;QAACF,OAAO,EAAPA,OAAO;QAAEC,MAAM,EAANA;MAAM,CAAC,CAAC;IACvC,CAAC;IACDE,MAAM,CAACC,MAAM,gCAAOF,IAAI,CAAC;IACzBH,QAAQ,CAAC,MAAKC,OAAO,EAAE,MAAKC,MAAM,CAAC;IAAA;EACpC;EAAC;AAAA,iCARmCI,OAAO;AAY5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAAA,IAYaC,eAAe;EAAA;EAAA;EAC3B,yBAAYC,QAAQ,EAAE;IAAA;IAAA;IACrB;IACA,OAAKC,SAAS,GAAGD,QAAQ;IAAA;EAC1B;EAAC;IAAA;IAAA,OAED,mBAAU;MAAA;MACT,OAAO,IAAI,CAACC,SAAS,EAAE,CACrBC,IAAI,CAAC,UAACC,IAAI,EAAK;QACf,MAAI,CAACV,OAAO,CAACU,IAAI,CAAC;MACnB,CAAC,CAAC,SACI,CAAC,UAAAC,MAAM,EAAI;QAChB,MAAI,CAACV,MAAM,CAACU,MAAM,CAAC;MACpB,CAAC,CAAC;IACJ;EAAC;EAAA;AAAA,EAdmCb,eAAe;AAkBpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAQO,SAASc,KAAK,CAACL,QAAQ,EAAE;EAC/B,IAAIM,OAAO,EAAEC,QAAQ,EAAEC,OAAO;EAC9B,IAAMC,EAAE,GAAG,IAAIX,OAAO,CAAC,UAAUL,OAAO,EAAEC,MAAM,EAAE;IACjDa,QAAQ,GAAGd,OAAO;IAClBa,OAAO,GAAGZ,MAAM;EACjB,CAAC,CAACgB,IAAI,CAACL,KAAK,CAAC,CAAC;EAEd,IAAMM,QAAQ,GAAI,UAAUX,QAAQ,EAAE;IACrC,IAAIY,SAAS,GAAGC,SAAS;IAEzB,OAAO,YAAW;MACjBL,OAAO,GAAG,IAAI;MACd,IAAII,SAAS,EAAE;QACd,OAAOA,SAAS;QAChBE,OAAO,CAACC,GAAG,CAAC,oBAAoB,CAAC;MAClC;MACA,OAAOH,SAAS,GAAGZ,QAAQ,EAAE,CAC3BE,IAAI,CAAC,UAAAC,IAAI,EAAI;QACbI,QAAQ,CAACJ,IAAI,CAAC;MACf,CAAC,CAAC,SACI,CAAC,UAAAC,MAAM,EAAI;QAChBE,OAAO,CAACF,MAAM,CAAC;MAChB,CAAC,CAAC;IACJ,CAAC;EACF,CAAC,CAAEJ,QAAQ,CAAC;EAEZ,OAAO;IACN,IAAIgB,OAAO,GAAG;MAAE,OAAOP,EAAE;IAAC,CAAC;IAE3B,IAAIQ,MAAM,GAAG;MACZ,OAAOT,OAAO,GAAG,IAAI,GAAG,KAAK;IAC9B,CAAC;IAEDU,OAAO,qBAAyB;MAAA,IAAxBC,QAAQ,uEAAC,YAAW,CAAC,CAAC;MAC7BR,QAAQ,EAAE,WAAQ,CAACQ,QAAQ,CAAC;IAC7B;EACD,CAAC;AACF"}